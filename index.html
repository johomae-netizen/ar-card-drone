<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DIAG3 Custom Marker + Drone</title>

<script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
<style>body{margin:0;overflow:hidden}</style>
</head>
<body>
<a-scene embedded arjs="trackingMethod: best; debugUIEnabled: false;">
  <a-marker id="marker" type="pattern"
    url="https://johomae-netizen.github.io/ar-card-drone/mylogo.patt"></a-marker>
  <a-entity id="root"></a-entity>
  <a-entity camera></a-entity>
</a-scene>

<script>
  const marker = document.getElementById('marker');
  const root = document.getElementById('root');
  let ent = null;

  function spawn(){
    if(ent && ent.parentNode) ent.parentNode.removeChild(ent);
    ent = document.createElement('a-entity');
    ent.setAttribute('gltf-model','https://johomae-netizen.github.io/ar-card-drone/drone.glb');
    ent.setAttribute('scale','0.6 0.6 0.6');
    root.appendChild(ent);
  }

  // 初回は0.4秒遅延して姿勢安定を待つ
  marker.addEventListener('markerFound', ()=> setTimeout(spawn, 400));
</script>
</body>
</html>
